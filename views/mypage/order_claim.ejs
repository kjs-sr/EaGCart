<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>반품/교환 신청 | EaGCart</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-slate-50 min-h-screen flex flex-col">
    <%- include('../partials/header.ejs') %>

    <main
      class="max-w-7xl mx-auto w-full px-6 py-12 grid gap-8 lg:grid-cols-[260px_1fr] flex-grow"
    >
      <%- include('./partials/nav.ejs', { activeTab: 'orders' }) %>

      <section class="space-y-6">
        <header>
          <p class="text-xs uppercase tracking-[0.4em] text-slate-400 mb-2">
            주문 목록 / 클레임
          </p>
          <h1 class="text-3xl font-bold">반품/교환 신청</h1>
          <p class="text-sm text-slate-500 mt-2">
            신청하실 상품을 선택하고 사유를 입력해주세요.
          </p>
        </header>

        <form
          action="/mypage/orders/claim"
          method="POST"
          class="space-y-8"
          onsubmit="return validateClaimForm()"
        >
          <input type="hidden" name="orderId" value="<%= orderId %>" />

          <!-- 1. 상품 선택 -->
          <div
            class="bg-white rounded-3xl p-6 border border-slate-100 shadow-sm"
          >
            <h3 class="font-bold text-lg mb-4 text-slate-800">1. 상품 선택</h3>
            <div class="space-y-4">
              <% if (items && items.length > 0) { %> <% items.forEach((item) =>
              { %>
              <label
                class="flex items-start gap-4 p-4 border border-slate-100 rounded-xl <%= item.isClaimed ? 'bg-gray-50 opacity-60 cursor-not-allowed' : 'cursor-pointer hover:bg-slate-50' %> transition"
              >
                <input type="checkbox" name="selectedItems" value="<%= item.code
                %>" class="mt-1 w-4 h-4 text-purple-600 rounded
                focus:ring-purple-500 border-gray-300" <%= item.isClaimed ?
                'disabled' : '' %>>

                <div
                  class="w-20 h-20 bg-white border border-slate-200 rounded-lg flex items-center justify-center overflow-hidden flex-shrink-0"
                >
                  <% if (item.image) { %>
                  <img
                    src="<%= item.image %>"
                    class="w-full h-full object-contain"
                  />
                  <% } else { %>
                  <span class="text-xs text-slate-300">No Img</span>
                  <% } %>
                </div>
                <div class="flex-1">
                  <p class="font-bold text-slate-800">
                    <%= item.name %> <% if(item.isClaimed) { %>
                    <span class="text-xs text-rose-500 font-bold ml-1"
                      ><%= item.statusText %></span
                    >
                    <% } %>
                  </p>
                  <p class="text-sm text-slate-500 mt-1">
                    <%= item.price.toLocaleString() %>원 / <%= item.qty %>개
                  </p>
                </div>
              </label>
              <% }) %> <% } else { %>
              <p class="text-center text-slate-400 py-4">
                신청 가능한 상품이 없습니다.
              </p>
              <% } %>
            </div>
          </div>

          <!-- 2. 신청 정보 입력 -->
          <div
            class="bg-white rounded-3xl p-6 border border-slate-100 shadow-sm space-y-6"
          >
            <h3 class="font-bold text-lg text-slate-800">2. 신청 정보</h3>

            <div>
              <label class="block text-sm font-bold text-slate-700 mb-2"
                >신청 구분</label
              >
              <div class="flex gap-4">
                <label class="flex items-center gap-2 cursor-pointer">
                  <input
                    type="radio"
                    name="claimType"
                    value="RETURN"
                    checked
                    class="text-purple-600 focus:ring-purple-500"
                  />
                  <span class="text-sm">반품</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer">
                  <input
                    type="radio"
                    name="claimType"
                    value="EXCHANGE"
                    class="text-purple-600 focus:ring-purple-500"
                  />
                  <span class="text-sm">교환</span>
                </label>
              </div>
            </div>

            <div>
              <label class="block text-sm font-bold text-slate-700 mb-2"
                >신청 사유</label
              >
              <select
                name="reasonCode"
                id="reasonCode"
                class="w-full px-4 py-2 rounded-xl border border-slate-200 focus:outline-none focus:border-purple-500 text-sm"
              >
                <option value="">사유를 선택해주세요</option>
                <option value="SIMPLE_CHANGE">
                  단순 변심 (색상/사이즈 등)
                </option>
                <option value="DEFECT">상품 불량/파손</option>
                <option value="WRONG_DELIVERY">오배송</option>
                <option value="DELAY">배송 지연</option>
                <option value="ETC">기타</option>
              </select>
            </div>

            <div>
              <label class="block text-sm font-bold text-slate-700 mb-2"
                >상세 사유</label
              >
              <textarea
                name="reasonDetail"
                rows="4"
                class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:outline-none focus:border-purple-500 text-sm resize-none"
                placeholder="상세 사유를 입력해주세요."
              ></textarea>
            </div>
          </div>

          <div class="flex justify-end gap-3 pt-4">
            <a
              href="/mypage/orders"
              class="px-6 py-3 bg-white border border-slate-200 rounded-xl font-bold text-slate-600 hover:bg-slate-50 transition"
              >취소</a
            >
            <button
              type="submit"
              class="px-6 py-3 bg-purple-600 text-white rounded-xl font-bold hover:bg-purple-700 transition shadow-md"
            >
              신청하기
            </button>
          </div>
        </form>
      </section>
    </main>

    <%- include('../partials/footer.ejs') %>

    <script>
      function validateClaimForm() {
        // 1. 상품 선택 확인
        const checkboxes = document.querySelectorAll(
          'input[name="selectedItems"]:checked'
        );
        if (checkboxes.length === 0) {
          alert("신청할 상품을 하나 이상 선택해주세요.");
          return false;
        }

        // 2. 사유 선택 확인
        const reason = document.getElementById("reasonCode").value;
        if (!reason) {
          alert("신청 사유를 선택해주세요.");
          return false;
        }

        return true;
      }
    </script>
  </body>
</html>
